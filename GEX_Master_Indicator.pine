//V6
indicator("GEX Master Auto: 20251221", overlay=true, max_boxes_count=500, max_labels_count=500)

// === SETTINGS ===
var float width_scale = input.float(0.5, "Bar Width Scale", minval=0.1, step=0.1)
var float text_size_threshold = input.float(100000000, "Text Label Threshold (Notional)")
var bool show_dashboard = input.bool(true, "Show Dashboard")

// === DATA LOADING ===
load_data() =>
    string sym = syminfo.ticker
    float[] s = array.new_float(0)
    float[] g = array.new_float(0)
    // -- AUTO-GENERATED DATA BLOCKS START --
    
    if sym == "BBAI"
        s := array.from(0.5, 0.5, 1.0, 1.0, 1.5, 1.5, 2.0, 2.0, 2.5, 2.5, 3.0, 3.0, 3.5, 3.5, 4.0, 4.0, 4.5, 4.5, 5.0, 5.0, 5.5, 5.5, 6.0, 6.0, 7.0, 7.0, 8.0, 8.0, 9.0, 9.0, 10.0, 10.0, 11.0, 11.0, 12.0, 12.0, 13.0, 13.0, 14.0, 14.0, 15.0, 15.0, 16.0, 16.0, 17.0, 17.0)
        g := array.from(0, 540, 12680, 1894, 9940, 40783, 18111, 24768, 0, 14946, 52449, 137751, 296322, 113906, 341320, 1015905, 389836, 509910, 2245334, 1226871, 1139083, 1449272, 3218181, 2266647, 962701, 5038697, 3121395, 1126869, 48780, 705458, 2111354, 128603, 266137, 0, 0, 450210, 66771, 0, 4690, 33270, 257934, 3698, 292, 63541, 237341, 96)

    if sym == "BITO"
        s := array.from(3.0, 3.0, 4.0, 4.0, 5.0, 5.0, 6.0, 6.0, 7.0, 7.0, 8.0, 8.0, 9.0, 9.0, 10.0, 10.0, 11.0, 11.0, 12.0, 12.0, 13.0, 13.0, 14.0, 14.0, 15.0, 15.0, 16.0, 16.0, 17.0, 17.0, 18.0, 18.0, 19.0, 19.0, 20.0, 20.0, 21.0, 21.0, 22.0, 22.0, 23.0, 23.0, 24.0, 24.0, 25.0, 25.0, 26.0, 26.0, 27.0, 27.0, 28.0, 28.0, 29.0, 29.0, 30.0, 30.0, 31.0, 32.0, 32.0, 33.0, 33.0, 34.0, 35.0, 35.0, 36.0, 36.0, 37.0, 37.0, 38.0, 40.0, 40.0, 41.0, 42.0, 43.0, 43.0, 44.0, 45.0, 45.0, 46.0, 46.0, 47.0, 47.0, 48.0, 48.0, 49.0, 49.0, 50.0, 50.0)
        g := array.from(0, 55438, 455, 10, 71, 64200, 1849, 62, 0, 6726, 4324, 0, 8029, 23185, 717015, 15747, 12237, 133883, 880859, 701631, 1208319, 609820, 399634, 1392632, 628204, 668349, 247272, 386381, 232012, 148568, 122504, 618849, 115804, 135327, 530846, 341724, 40745, 101136, 136969, 49370, 54316, 114545, 82672, 22908, 147456, 197145, 27996, 12558, 20994, 32276, 41608, 9494, 259, 9717, 127220, 49852, 12399, 2174, 8521, 10598, 5199, 8049, 111952, 99751, 7859, 11551, 2710, 11162, 38974, 349, 20609, 1559, 7940, 38, 5076, 2470, 220, 14149, 2983, 1805, 1616, 3676, 1390, 906, 15954, 1377, 29096, 245508)

    if sym == "BMNU"
        s := array.from(2.0, 2.0, 3.0, 3.0, 4.0, 4.0, 5.0, 5.0, 6.0, 6.0, 7.0, 7.0, 8.0, 8.0, 9.0, 9.0, 10.0, 10.0, 11.0, 11.0, 12.0, 12.0, 13.0, 13.0, 14.0, 14.0, 15.0, 15.0, 16.0, 16.0, 17.0, 17.0, 18.0, 18.0, 19.0, 19.0, 20.0, 20.0, 21.0, 21.0, 22.0, 22.0, 23.0, 23.0, 24.0, 24.0)
        g := array.from(13, 0, 4019, 761, 6288, 3857, 30512, 15568, 13888, 44133, 107662, 27749, 138873, 199870, 9022, 71357, 11942, 38683, 492933, 4899, 1299, 132996, 157590, 2030, 1569, 1830, 1592, 328, 312, 79, 584, 446, 0, 138, 99, 0, 0, 416, 953, 0, 1837, 692, 796, 0, 30, 576)

    if sym == "MSTU"
        s := array.from(1.0, 1.0, 2.0, 2.0, 3.0, 3.0, 4.0, 4.0, 5.0, 5.0, 6.0, 6.0, 7.0, 7.0, 8.0, 8.0, 9.0, 9.0, 10.0, 10.0, 11.0, 11.0, 12.0, 12.0, 13.0, 13.0, 14.0, 14.0, 15.0, 15.0, 16.0, 16.0, 17.0, 17.0, 18.0, 18.0, 19.0, 19.0, 20.0, 20.0, 21.0, 21.0, 22.0, 22.0, 25.0, 25.0)
        g := array.from(0, 0, 0, 0, 0, 0, 0, 0, 0, 30063, 0, 0, 0, 0, 0, 0, 18256, 221, 36127, 5808, 178775, 40517, 6442, 794, 0, 11481, 1533, 0, 0, 59536, 493, 0, 0, 0, 0, 0, 4908, 0, 36, 21459, 0, 0, 0, 30, 29024, 0)

    if sym == "OPEN"
        s := array.from(0.5, 0.5, 1.0, 1.0, 1.5, 1.5, 2.0, 2.0, 2.5, 2.5, 3.0, 3.0, 3.5, 3.5, 4.0, 4.0, 4.5, 4.5, 5.0, 5.0, 5.5, 5.5, 6.0, 6.0, 7.0, 7.0, 8.0, 8.0, 9.0, 9.0, 10.0, 10.0, 11.0, 11.0, 12.0, 12.0, 13.0, 13.0, 14.0, 14.0, 15.0, 15.0, 16.0, 16.0, 17.0, 17.0, 18.0, 18.0, 19.0, 19.0, 20.0, 20.0, 21.0, 21.0)
        g := array.from(1899, 5112, 69, 14, 76526, 32729, 74, 449, 163457, 52005, 4820, 9320, 70349, 97445, 5063, 69744, 566881, 81064, 37794, 619241, 294437, 235826, 124048, 846727, 672106, 1346187, 1072289, 86976, 20606, 1578137, 742240, 0, 359660, 269, 0, 48552, 7581, 0, 0, 15251, 29509, 0, 4871, 5534, 28531, 0, 0, 137213, 15628, 0, 0, 357233, 1292925, 0)

    if sym == "QQQ"
        s := array.from(174.78, 174.78, 179.78, 179.78, 184.78, 184.78, 189.78, 189.78, 194.78, 194.78, 199.78, 199.78, 204.78, 204.78, 209.78, 209.78, 214.78, 219.78, 224.78, 229.78, 229.78, 234.78, 234.78, 239.78, 239.78, 244.78, 249.78, 254.78, 259.78, 264.78, 269.78, 274.78, 274.78, 279.78, 284.78, 289.78, 289.78, 294.78, 299.78, 299.78, 304.78, 309.78, 309.78, 314.78, 314.78, 319.78, 319.78, 324.78, 324.78, 329.78, 329.78, 334.78, 334.78, 339.78, 339.78, 344.78, 349.78, 349.78, 354.78, 354.78, 359.78, 359.78, 364.78, 364.78, 369.78, 369.78, 370.0, 370.0, 374.78, 374.78, 379.78, 379.78, 380.0, 380.0, 384.78, 389.78, 389.78, 390.0, 390.0, 394.78, 394.78, 399.78, 400.0, 400.0, 404.78, 404.78, 409.78, 409.78, 410.0, 410.0, 414.78, 414.78, 419.78, 419.78, 420.0, 420.0, 424.78, 424.78, 429.78, 429.78, 430.0, 430.0, 434.78, 434.78, 439.78, 439.78, 440.0, 440.0, 444.78, 444.78, 449.78, 449.78, 450.0, 450.0, 454.78, 454.78, 459.78, 460.0, 460.0, 464.78, 464.78, 469.78, 470.0, 470.0, 474.78, 474.78, 479.78, 479.78, 480.0, 480.0, 484.78, 484.78, 489.78, 489.78, 490.0, 490.0, 494.78, 494.78, 499.78, 499.78, 500.0, 500.0, 504.78, 504.78, 509.78, 509.78, 510.0, 510.0, 514.78, 514.78, 519.78, 519.78, 520.0, 520.0, 524.78, 524.78, 529.78, 529.78, 530.0, 530.0, 534.78, 534.78, 539.78, 539.78, 540.0, 540.0, 544.78, 544.78, 549.78, 549.78, 550.0, 550.0, 554.78, 554.78, 559.78, 559.78, 560.0, 560.0, 564.78, 564.78, 569.78, 569.78, 570.0, 570.0, 574.78, 574.78, 579.78, 579.78, 580.0, 580.0, 584.78, 584.78, 589.78, 589.78, 590.0, 590.0, 594.78, 594.78, 599.78, 599.78, 600.0, 600.0, 604.78, 604.78, 609.78, 609.78, 610.0, 610.0, 615.0, 615.0, 620.0, 620.0, 625.0, 625.0, 630.0, 630.0, 635.0, 635.0, 640.0, 640.0, 645.0, 645.0, 650.0, 650.0, 655.0, 655.0, 660.0, 660.0, 665.0, 665.0, 670.0, 670.0, 675.0, 675.0, 680.0, 680.0, 685.0, 685.0, 690.0, 690.0, 695.0, 700.0, 700.0, 705.0, 710.0, 715.0, 720.0, 725.0, 730.0, 735.0, 740.0, 745.0, 750.0, 750.0, 755.0, 755.0, 760.0, 760.0, 765.0, 770.0, 775.0, 780.0, 785.0, 790.0)
        g := array.from(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 137773, 0, 557820, 0, 76753, 480696, 33625, 176274, 2007623, 0, 194968, 161959, 225509, 24741, 1224169, 0, 514137, 45101, 117043, 17892, 190526, 631612, 163317, 825039, 316022, 158319, 3749571, 1239779, 703985, 105998, 507659, 96620, 418442, 2622330, 2021259, 321575, 969538, 220635, 3639007, 9625599, 1270012, 238219, 1771501, 1322826, 7900680, 145116, 2278235, 856382, 1886138, 879580, 185837, 11046218, 1181289, 5177903, 1880894, 1071526, 692756, 18703558, 5580551, 1200909, 1845787, 3149055, 15368789, 2064571, 3671090, 4945791, 2298040, 2919349, 19766138, 42049534, 10976992, 10040401, 2369364, 2820137, 17331495, 11613417, 12777986, 13098080, 9158229, 20209384, 23578149, 12322277, 7652897, 25820291, 12147916, 4264634, 3614080, 18397161, 2448092, 174052, 914379, 13014170, 4445783, 136231, 1690305, 287208, 23198, 1210164, 1990656, 3948, 10859, 766610, 921721, 10365, 7588, 356867, 497972, 0, 0, 0, 185, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 370, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

    if sym == "RR"
        s := array.from(1.0, 1.0, 2.0, 2.0, 3.0, 3.0, 4.0, 4.0, 5.0, 5.0, 6.0, 6.0, 7.0, 7.0, 8.0, 8.0)
        g := array.from(0, 0, 341, 2766, 77254, 175022, 136026, 433208, 0, 720698, 142901, 0, 0, 42661, 3327, 0)

    if sym == "SPY"
        s := array.from(210.0, 210.0, 215.0, 215.0, 220.0, 220.0, 225.0, 225.0, 230.0, 230.0, 235.0, 235.0, 240.0, 240.0, 245.0, 250.0, 250.0, 255.0, 255.0, 260.0, 260.0, 265.0, 270.0, 270.0, 275.0, 275.0, 280.0, 280.0, 285.0, 290.0, 290.0, 295.0, 295.0, 300.0, 300.0, 305.0, 305.0, 310.0, 310.0, 315.0, 315.0, 320.0, 320.0, 325.0, 325.0, 330.0, 330.0, 335.0, 335.0, 340.0, 340.0, 345.0, 345.0, 350.0, 350.0, 355.0, 355.0, 360.0, 360.0, 365.0, 365.0, 370.0, 370.0, 375.0, 375.0, 380.0, 380.0, 385.0, 385.0, 390.0, 390.0, 395.0, 395.0, 400.0, 400.0, 405.0, 405.0, 410.0, 410.0, 415.0, 415.0, 420.0, 420.0, 425.0, 425.0, 430.0, 430.0, 435.0, 435.0, 440.0, 440.0, 445.0, 445.0, 450.0, 450.0, 455.0, 455.0, 460.0, 460.0, 465.0, 465.0, 470.0, 470.0, 475.0, 475.0, 480.0, 480.0, 485.0, 485.0, 490.0, 490.0, 495.0, 495.0, 500.0, 500.0, 505.0, 505.0, 510.0, 510.0, 515.0, 515.0, 520.0, 520.0, 525.0, 525.0, 530.0, 530.0, 535.0, 535.0, 540.0, 540.0, 545.0, 545.0, 550.0, 550.0, 555.0, 555.0, 560.0, 560.0, 565.0, 565.0, 570.0, 570.0, 575.0, 575.0, 580.0, 580.0, 585.0, 585.0, 590.0, 590.0, 595.0, 595.0, 600.0, 600.0, 605.0, 605.0, 610.0, 610.0, 615.0, 615.0, 620.0, 620.0, 621.0, 621.0, 622.0, 622.0, 623.0, 623.0, 624.0, 624.0, 625.0, 625.0, 626.0, 626.0, 627.0, 627.0, 628.0, 628.0, 629.0, 629.0, 630.0, 630.0, 631.0, 631.0, 632.0, 632.0, 633.0, 633.0, 634.0, 634.0, 635.0, 635.0, 636.0, 636.0, 637.0, 637.0, 638.0, 638.0, 639.0, 639.0, 640.0, 640.0, 641.0, 641.0, 642.0, 642.0, 643.0, 643.0, 644.0, 644.0, 645.0, 645.0, 646.0, 646.0, 647.0, 647.0, 648.0, 648.0, 649.0, 649.0, 650.0, 650.0, 651.0, 651.0, 652.0, 652.0, 653.0, 653.0, 654.0, 654.0, 655.0, 655.0, 656.0, 656.0, 657.0, 657.0, 658.0, 658.0, 659.0, 659.0, 660.0, 660.0, 661.0, 661.0, 662.0, 662.0, 663.0, 663.0, 664.0, 664.0, 665.0, 665.0, 666.0, 666.0, 667.0, 667.0, 668.0, 668.0, 669.0, 669.0, 670.0, 670.0, 671.0, 671.0, 672.0, 672.0, 673.0, 673.0, 674.0, 674.0, 675.0, 675.0, 676.0, 676.0, 677.0, 677.0, 678.0, 678.0, 679.0, 679.0, 680.0, 681.0, 682.0, 683.0, 684.0, 685.0, 686.0, 687.0, 688.0, 689.0, 690.0, 691.0, 692.0, 693.0, 694.0, 695.0, 696.0, 697.0, 698.0, 699.0, 700.0, 701.0, 702.0, 703.0, 704.0, 705.0, 706.0, 707.0, 708.0, 709.0, 710.0, 711.0, 712.0, 713.0, 714.0, 715.0, 716.0, 717.0, 718.0, 719.0, 720.0, 725.0, 730.0, 735.0, 740.0, 745.0, 750.0, 755.0, 760.0, 765.0, 770.0, 775.0, 780.0, 785.0, 790.0, 795.0, 800.0, 805.0, 810.0, 815.0, 820.0, 825.0, 830.0, 835.0, 840.0, 850.0, 930.0, 955.0, 970.0, 975.0, 980.0, 985.0, 995.0, 1000.0)
        g := array.from(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1825013, 1218286, 0, 0, 1544179, 1322220, 0, 0, 1091618, 2017295, 0, 0, 1580934, 5781534, 0, 0, 1588148, 13047692, 0, 0, 6346197, 0, 2387022, 0, 3750626, 0, 3586046, 378438, 5065019, 157637, 2790, 1089, 225157, 410837, 272, 136, 331065, 8494449, 415465, 408, 220801, 646612, 408, 1089, 205554, 284509, 2450, 777160, 8562786, 158930, 1225, 204, 840936, 1089, 291996, 119453, 1089, 1259737, 13325327, 191941, 191397, 5445, 546830, 298530, 2382, 325484, 2722, 24428893, 5795351, 2858, 336102, 4778127, 278928, 2450, 505991, 8356959, 292813, 11996095, 3945018, 2858, 6664127, 11603976, 952, 378438, 7623, 4900, 4259748, 41913574, 15631965, 2450, 5729397, 688812, 2450, 17764, 9396372, 8902632, 23141, 5424740, 18069287, 786553, 8848, 2246, 1076099, 1074738, 10481, 2994, 1067932, 32891488, 7681759, 14701, 599716, 637151, 13885, 7078, 499389, 960526, 13272, 11254260, 19800235, 979312, 48598, 33351, 820857, 593794, 26681, 24503, 739724, 30370311, 14257811, 49006, 479582, 1014841, 208005, 268990, 7342117, 1351216, 630549, 20992180, 22073045, 965290, 1070314, 741698, 1292136, 2041118, 1874496, 1875653, 1466517, 30599416, 1658867, 5214285, 1582908, 2304936, 44969398, 2562968, 2333863, 3429634, 2962167, 30737928, 1708691, 1202291, 2610613, 1675407, 18856044, 1617076, 1168871, 1557588, 1624563, 38004494, 2033495, 1759467, 1835018, 1480607, 11329199, 1076508, 560306, 863330, 260550, 10177820, 392732, 494148, 270896, 267901, 4251580, 153553, 168459, 247482, 126804, 3816580, 2634232, 1279136, 1405327, 1426631, 708755, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

    // -- AUTO-GENERATED DATA BLOCKS END --
    [s, g]

// === MAIN LOGIC ===
if barstate.islast
    [strikes, gex_vals] = load_data()
    if array.size(strikes) > 0
        float max_gex = 0.0
        float total_gex = 0.0
        for i = 0 to array.size(gex_vals) - 1
            val = array.get(gex_vals, i)
            total_gex += val
            if math.abs(val) > max_gex
                max_gex := math.abs(val)

        for i = 0 to array.size(strikes) - 1
            s_price = array.get(strikes, i)
            g_val = array.get(gex_vals, i)
            float len_norm = max_gex > 0 ? (math.abs(g_val) / max_gex) * (50 * width_scale) : 0
            col = g_val > 0 ? color.new(color.green, 40) : color.new(color.red, 40)
            border_col = g_val > 0 ? color.green : color.red
            float box_height = (s_price * 0.0005)
            box.new(bar_index + 5, s_price + box_height, bar_index + 5 + math.round(len_norm), s_price - box_height,
                    border_color=border_col, bgcolor=col)
            if math.abs(g_val) > text_size_threshold
                label.new(bar_index + 5 + math.round(len_norm), s_price,
                    str.tostring(math.round(g_val / 1000000)) + "M",
                    style=label.style_none, textcolor=border_col, size=size.small)

        if show_dashboard
            string regime = total_gex > 0 ? "Short Vol (Pos GEX)" : "Long Vol (Neg GEX)"
            color reg_col = total_gex > 0 ? color.green : color.red
            var table dash = table.new(position.top_right, 1, 1)
            table.cell(dash, 0, 0, syminfo.ticker + " GEX: " +
                str.tostring(math.round(total_gex/1000000)) + "M\n" + regime + "\nDate: 20251221",
                bgcolor=color.new(reg_col, 80), text_color=color.white)
    else
        var table err = table.new(position.bottom_right, 1, 1)
        table.cell(err, 0, 0, "No GEX Data for " + syminfo.ticker, bgcolor=color.gray, text_color=color.white)
